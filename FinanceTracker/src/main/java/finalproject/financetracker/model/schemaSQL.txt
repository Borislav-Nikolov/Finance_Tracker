CREATE SCHEMA IF NOT EXISTS final_project;

USE final_project;

CREATE TABLE IF NOT EXISTS users (
	id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(45) NOT NULL UNIQUE,
    password VARCHAR(100) NOT NULL,
    first_name VARCHAR(45),
    last_name VARCHAR(45),
    email VARCHAR(60) NOT NULL UNIQUE,
    INDEX username_idx (username ASC)
);

CREATE TABLE IF NOT EXISTS images (
	id INT PRIMARY KEY AUTO_INCREMENT,
    uri VARCHAR(200) NOT NULL
);

CREATE TABLE IF NOT EXISTS categories (
	id INT PRIMARY KEY AUTO_INCREMENT,
    category_name VARCHAR(45) NOT NULL,
    is_income TINYINT(1) NOT NULL,
    user_id INT,
    image_id INT NOT NULL,
    INDEX user_fk_idx (user_id ASC),
    INDEX image_fk_idx (image_id ASC),
    CONSTRAINT user_fk FOREIGN KEY (user_id)
    REFERENCES users(user_id),
    CONSTRAINT image_fk FOREIGN KEY (image_id)
    REFERENCES images(image_id)
);

CREATE TABLE IF NOT EXISTS accounts (
	id INT PRIMARY KEY AUTO_INCREMENT,
    account_name VARCHAR(45) NOT NULL,
    amount DOUBLE NOT NULL,
    user_id INT NOT NULL,
    INDEX user_fk_idx (user_id ASC) ,
    CONSTRAINT acc_user_fk FOREIGN KEY (user_id)
    REFERENCES users(user_id)
);

CREATE TABLE IF NOT EXISTS transactions (
	id INT PRIMARY KEY AUTO_INCREMENT,
    transaction_name VARCHAR(45) NOT NULL,
    amount DOUBLE NOT NULL,
    execution_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    user_id INT,
    category_id INT NOT NULL,
    INDEX user_fk_idx (user_id ASC) ,
    INDEX category_fk_idx (category_id ASC) ,
    CONSTRAINT trans_user_fk FOREIGN KEY (user_id)
    REFERENCES users(user_id),
    CONSTRAINT trans_category_fk FOREIGN KEY (category_id)
    REFERENCES categories(category_id)
);

CREATE TABLE IF NOT EXISTS planned_transactions (
	id INT PRIMARY KEY AUTO_INCREMENT,
    pt_name VARCHAR(45) NOT NULL,
    pt_amount DOUBLE NOT NULL,
    next_execution_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    day_period INT,
    month_period INT,
    user_id INT,
    category_id INT NOT NULL,
    INDEX user_fk_idx (user_id ASC) ,
    INDEX category_fk_idx (category_id ASC) ,
    CONSTRAINT pt_user_fk FOREIGN KEY (user_id)
    REFERENCES users(user_id),
    CONSTRAINT pt_category_fk FOREIGN KEY (category_id)
    REFERENCES categories(category_id)
);

CREATE TABLE IF NOT EXISTS budgets (
	id INT PRIMARY KEY AUTO_INCREMENT,
    budget_name VARCHAR(45) NOT NULL,
    amount DOUBLE NOT NULL,
    starting_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    end_date TIMESTAMP,
    category_id INT NOT NULL,
    INDEX category_fk_idx (category_id ASC) ,
    CONSTRAINT budg_category_fk FOREIGN KEY (category_id)
    REFERENCES categories(category_id)
);